// server.js

// First, update your CORS configuration in server.js
const cors = require('cors');

// Replace your existing CORS configuration with this:
app.use(cors({
    origin: ['https://b-l-u-e.vercel.app', 'http://localhost:3000'],
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Authorization', 'X-Requested-With', 'Accept'],
    credentials: true,
    maxAge: 86400 // 24 hours
}));

// Add this before your routes to handle preflight requests
app.options('*', cors());

// Ensure your routes don't have double slashes
// Update your fetch URL in SignUp.js from:
// ${process.env.REACT_APP_BACKEND_URL}//signup
// to:
// ${process.env.REACT_APP_BACKEND_URL}/signup

// vercel.json
{
    "version": 2,
    "builds": [
        {
            "src": "server.js",
            "use": "@vercel/node"
        }
    ],
    "routes": [
        {
            "src": "/(.*)",
            "dest": "server.js"
        }
    ],
    "headers": [
        {
            "source": "/(.*)",
            "headers": [
                { "key": "Access-Control-Allow-Credentials", "value": "true" },
                { "key": "Access-Control-Allow-Origin", "value": "https://b-l-u-e.vercel.app" },
                { "key": "Access-Control-Allow-Methods", "value": "GET,DELETE,PATCH,POST,PUT,OPTIONS" },
                { "key": "Access-Control-Allow-Headers", "value": "X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization" }
            ]
        }
    ]
}